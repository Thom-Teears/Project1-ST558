---
title: "ST-558 Project 1 XML Vignette"
author: "Yan Shi and Thom Teears"
date: "6/11/2019"
output:
  html_document:
    toc: yes
    smooth_scroll: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# General Description of XML Data 

XML stands for eXtensible Markup Language and is defined by [Merriam-Webster](https://www.merriam-webster.com/dictionary/XML) as "a markup language with use and design similar to HTML but employing tags defined by the user that can be used to indicate both the logical structure and the display specifications of the coded data."

According to [TechTarget](https://searchmicroservices.techtarget.com/definition/XML-Extensible-Markup-Language), XML is most often used for displaying data on the internet and corporate networks. The advantage of XML is that it is self-describing meaning that the information format is described in the data. Furthermore, the format is considered human-readable and machine-readable which, means that both users and computers can make sense of the format.

[Lifewire](https://www.lifewire.com/reasons-to-use-xml-3471386) provides 5 reasons why XML is a good way to store data.

* Simplicity  
    - The user creates the tags and the overall setup of the document.
* Organization  
    - The user can segment the design process by creating the data page and then work on the design as appropriate.
* Accessibility  
    - When using XML, the data and the format design is separated which, makes changes easy and time-saving since the user doens't have to wade through many lines of code to make changes like in HTML.
* Standardization  
    - XML is an international standard and this allows users world-wide to utilize XML data.
* Multiple Applications  
    - XML allows the user to create many different display pages with different styles and formats with one XML data page.

# Packages/Functions for Reading XML Data
* R package XML, xml2 are available for reading XML data files.
* For this project, I choose package xml2. Package xml2 is similar to the XML package. The reasons that I use [xlm2](https://www.rdocumentation.org/packages/xml2/versions/1.2.0) are as follows:  
    + xml2 takes care of memory management for us. It will automatically free the memory used by an XML document as soon as the last reference to it goes away.  
    + xml2 supports modification and creation of XML nodes.  
    + xml2 has a very simple class hierarchy so don’t need to think about exactly what type of object you have, xml2 will just do the right thing.  
    + More convenient handling of namespaces in Xpath expressions, like xml_ns() and xml_ns_strip().


# Description of Specific Data Set Chosen

The XML data set chosen for this vignette was found at [Data.gov](https://catalog.data.gov/dataset/age-adjusted-death-rates-and-life-expectancy-at-birth-all-races-both-sexes-united-sta-1900). This data provides mortality trends in the U.S. since 1900 and it emphasizes the difference in  life-expectancy at birth and age-adjusted death rates by race and sex. This data is derived from census data.The categorical variables consist of year, race, and sex. The Quantitative variables are life-expectancy (in year) and age-adjusted death rate.

# Read in Data Set and Data Exploration

## Read in the data set describing the options your package’s functions allow.

```{r}
library(xml2)
# Read in xml file  
xml_file <- read_xml("https://data.cdc.gov/api/views/w9j2-ggv5/rows.xml?accessType=DOWNLOAD")

# Check the xml structure size
xml_length(xml_file)
xml_length(xml_children(xml_file))
xml_length(xml_child(xml_children(xml_file), 1))
xml_length(xml_child(xml_child(xml_children(xml_file), 1)))

# Check if each child has same amount of variables
max(xml_length(xml_children(xml_children(xml_file))))
min(xml_length(xml_children(xml_children(xml_file))))

# Set number of columns for final dataframe
ncols <- max(xml_length(xml_children(xml_children(xml_file))))

# Find the index of first element whose length is ncols
ind_name <- which(xml_length(xml_children(xml_children(xml_file)))==5)[1]

# Change it to a large list
xml_list <- as_list(xml_file)

# Check the list size
length(xml_list)
length(xml_list[[1]])
length(xml_list[[1]][[1]])
length(xml_list[[1]][[1]][[2]])

# For-loop to combine list to a dataframe
deathDF <- data.frame(matrix(ncol = ncols, nrow = 0))
colnames(deathDF) <- names(xml_list[[1]][[1]][[ind_name]])
for (i in 1:length(xml_list[[1]][[1]])){
  tmp <- as.data.frame(xml_list[[1]][[1]][[i]])
  colnames(tmp) <- names(xml_list[[1]][[1]][[i]])
  deathDF <- merge(deathDF, tmp, all = TRUE)
}

# create a table for deathDF
names(deathDF)<- c("Year", "Race", "Sex", "Mortality", "Life Expectancy")
library(DT)
datatable(deathDF, rownames = FALSE)
```

# Data Analysis
## create a useful function(s) 

## Create New Variable

Possibly create variables of difference in average life-expectancy or death rate between sexes and/ or races?

## Contigency Tables and Numeric Summaries

## Plotted Data


